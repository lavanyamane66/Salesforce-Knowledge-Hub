public class GitHubUploader {
    public static void uploadFile(String content, String filename) {
        String token = 'ghp_xxx'; // Replace with your GitHub token
        String repo = 'Salesforce-Knowledge-Hub';
        String owner = 'lavanyamane66';
        String path = 'reports/' + filename;
        
        Http http = new Http();
        HttpRequest getReq = new HttpRequest();
        
        // Step 1: Check if file exists and get the SHA
        getReq.setEndpoint('https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + path);
        getReq.setMethod('GET');
        getReq.setHeader('Authorization', 'Bearer ' + token);
        HttpResponse getRes = http.send(getReq);
        
        String sha = null; // Initialize sha as null
        if (getRes.getStatusCode() == 200) {
            // Parse the existing file SHA
            Map<String, Object> fileData = (Map<String, Object>) JSON.deserializeUntyped(getRes.getBody());
            sha = (String) fileData.get('sha');
        }

        // Step 2: Prepare the payload for file upload
        String body = JSON.serialize(new Map<String, Object>{
            'message' => 'Upload via Apex',
            'content' => EncodingUtil.base64Encode(Blob.valueOf(content)),
            'sha'     => sha
        });

        HttpRequest putReq = new HttpRequest();
        putReq.setEndpoint('https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + path);
        putReq.setMethod('PUT');
        putReq.setHeader('Authorization', 'Bearer ' + token);
        putReq.setHeader('Content-Type', 'application/json');
        putReq.setBody(body);

        // Step 3: Execute the request and handle the response
        HttpResponse putRes = http.send(putReq);
        System.debug('GitHub Response: ' + putRes.getBody());

        if (putRes.getStatusCode() == 201 || putRes.getStatusCode() == 200) {
            System.debug('File successfully uploaded or updated.');
        } else {
            System.debug('Failed to upload file. Status: ' + putRes.getStatus() + ' - ' + putRes.getBody());
        }
    }
}
