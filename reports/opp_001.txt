public class GitHubUploader {
    public static void uploadFile(String content, String filename) {
        String token = 'ghp_SfT0n22IQAnbMP3wXXXXXX';
        String repo = 'Salesforce-Knowledge-Hub';
        String owner = 'lavanyamane66';
        String path = 'reports/' + filename;
        
        Http http = new Http();
        HttpRequest getReq = new HttpRequest();
        getReq.setEndpoint('https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + path);
        getReq.setMethod('GET');
        req.setHeader('Authorization', 'token ' + token);
        
        HttpResponse getRes = http.send(getReq);
        
        String sha = null;
        if (getRes.getStatusCode() == 200) {
            Map<String, Object> responseMap = (Map<String, Object>) JSON.deserializeUntyped(getRes.getBody());
            sha = (String) responseMap.get('sha');
System.debug('GitHub Response: ' + getRes.getBody());

        }
        
        HttpRequest req = new HttpRequest();
        req.setEndpoint('https://api.github.com/repos/' + owner + '/' + repo + '/contents/' + path);
        req.setMethod('PUT');
        req.setHeader('Authorization', 'token ' + token);
        req.setHeader('Content-Type', 'application/json');
        
        Map<String, Object> body = new Map<String, Object>();
        body.put('message', 'Upload ' + filename);
        body.put('content', EncodingUtil.base64Encode(Blob.valueOf(content)));
        
        if (sha != null) {
            body.put('sha', sha); // Include sha if the file already exists
        }
        
        req.setBody(JSON.serialize(body));
        
        HttpResponse res = http.send(req);
        System.debug('GitHub Response: ' + res.getBody());
System.debug('Status Code: ' + res.getStatusCode());
  
    }
}

